<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tr√¨nh k√Ω vƒÉn b·∫£n - DNSE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <!-- Quill CSS -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

  <!-- Quill JS -->
  <script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

</head>
<body>
  <!-- Navbar -->
  <div id="navbar-placeholder"></div>

  <main class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Danh s√°ch vƒÉn b·∫£n tr√¨nh k√Ω</h2>
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createDocModal">
        <i class="bi bi-plus-circle"></i> T·∫°o vƒÉn b·∫£n m·ªõi
      </button>
    </div>

    <table class="table table-bordered table-hover table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Ti√™u ƒë·ªÅ</th>
          <th>Li√™n k·∫øt cu·ªôc h·ªçp</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Ng∆∞·ªùi t·∫°o</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody id="documentsTable">
        <!-- n·ªôi dung ƒë·ªông -->
      </tbody>
    </table>
  </main>

  <footer class="bg-dark text-white text-center py-3 mt-5 d-flex justify-content-center align-items-center gap-2">
    <img src="images/dnse_logo_notext.png" alt="DNSE Logo" style="height:25px; width:auto;">
    <span>&copy; 2025 DNSE</span>
  </footer>

  <!-- Modal: t·∫°o m·ªõi vƒÉn b·∫£n -->

<!-- Modal -->
<!-- Modal -->
<div class="modal fade" id="createDocModal" tabindex="-1" aria-labelledby="createDocLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createDocLabel">T·∫°o m·ªõi vƒÉn b·∫£n</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info border-0 shadow-sm d-flex align-items-center" role="alert">
          <i class="bi bi-info-circle-fill fs-4 me-3 text-info"></i>
          <div>
            <strong>L∆∞u √Ω v·ªÅ lu·ªìng k√Ω:</strong>
            <div class="small">H·ªá th·ªëng s·∫Ω tr√¨nh k√Ω tu·∫ßn t·ª± theo danh s√°ch b·∫°n ch·ªçn d∆∞·ªõi ƒë√¢y. <br>
            (Ng∆∞·ªùi x·∫øp th·ª© 1 k√Ω xong &rarr; Ng∆∞·ªùi th·ª© 2 m·ªõi nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o k√Ω).</div>
          </div>
        </div>
        <form id="createDocForm" enctype="multipart/form-data">

          <div class="mb-3">
            <label class="form-label">Ti√™u ƒë·ªÅ</label>
            <input type="text" class="form-control" id="docTitle" name="title" required>
          </div>

          <div class="mb-3">
            <label class="form-label">N·ªôi dung m√¥ t·∫£</label>
            <textarea class="form-control" id="docContent" name="description" rows="4"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Ch·ªçn cu·ªôc h·ªçp li√™n quan</label>
            <select class="form-select" id="bookingId" name="booking_id"></select>
          </div>

          <div class="mb-3">
            <label class="form-label">Ng∆∞·ªùi k√Ω</label>
            <select id="signers" name="signers" multiple class="form-select"></select>
          </div>
          
          <!-- TEMPLATE -->
          <div class="mb-3">
            <label class="form-label">Ch·ªçn m·∫´u vƒÉn b·∫£n (t√πy ch·ªçn)</label>
            <select class="form-select" id="templateId" name="template_id">
              <option value="">-- Kh√¥ng d√πng m·∫´u --</option>
            </select>
          </div>

          <!-- V√πng text ƒë·ªÉ ng∆∞·ªùi d√πng ch·ªânh s·ª≠a n·ªôi dung m·∫´u -->
          <div class="mb-3" id="templateEditorWrapper" style="display:none;">
            <label class="form-label">N·ªôi dung t·ª´ m·∫´u</label>
            <div id="docBody" style="height: 300px;"></div>
          </div>


          <!-- Upload file (b·∫Øt bu·ªôc n·∫øu KH√îNG d√πng template) -->
          <div class="mb-3" id="fileUploadWrapper">
            <label class="form-label">T·∫£i l√™n file vƒÉn b·∫£n (PDF ho·∫∑c DOCX)</label>
            <input type="file" class="form-control" id="docFile" name="file" accept=".pdf,.doc,.docx">
          </div>


          <!-- <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-upload"></i> L∆∞u v√† tr√¨nh k√Ω
          </button> -->
          <div class="d-flex gap-2 mt-3">
            <button type="button" id="saveDraftBtn" class="btn btn-secondary w-50">
              üíæ L∆∞u nh√°p
            </button>
            <button type="button" id="submitBtn" class="btn btn-primary w-50">
              üì§ L∆∞u v√† tr√¨nh k√Ω
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Modal: S·ª≠a vƒÉn b·∫£n -->
<div class="modal fade" id="editDocModal" tabindex="-1" aria-labelledby="editDocLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editDocLabel">Ch·ªânh s·ª≠a vƒÉn b·∫£n</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body">
        <form id="editDocForm">
          <input type="hidden" id="editDocId">
          
          <div class="mb-3">
            <label class="form-label">Ti√™u ƒë·ªÅ</label>
            <input type="text" class="form-control" id="editDocTitle" required>
          </div>

          <div class="mb-3">
            <label class="form-label">N·ªôi dung m√¥ t·∫£</label>
            <textarea class="form-control" id="editDocDescription" rows="4"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Ch·ªçn cu·ªôc h·ªçp li√™n quan</label>
            <select class="form-select" id="editBookingId"></select>
          </div>

          <div class="mb-3">
            <label class="form-label">Ng∆∞·ªùi k√Ω</label>
            <select id="editSigners" multiple class="form-select"></select>
          </div>

          <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-save"></i> L∆∞u thay ƒë·ªïi
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Modal: danh s√°ch ng∆∞·ªùi k√Ω -->
<div class="modal fade" id="signersModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Lu·ªìng k√Ω vƒÉn b·∫£n</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="modal-content">
        <!-- N·ªôi dung danh s√°ch ng∆∞·ªùi k√Ω s·∫Ω ƒë∆∞·ª£c load b·∫±ng JS -->
        <div class="text-center text-muted">ƒêang t·∫£i...</div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="docPreviewModal" tabindex="-1">
  <div class="modal-dialog modal-xl" style="max-width: 95%;">
    <div class="modal-content" style="height: 90vh;">
      <div class="modal-header">
        <h5 class="modal-title">Xem vƒÉn b·∫£n</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-0">
        <!-- ‚úÖ Frame cho PDF -->
        <iframe id="docPreviewFrame" style="width:100%;height:100%;display:none;" frameborder="0"></iframe>
        
        <!-- ‚úÖ Container cho HTML content t·ª´ template -->
        <div id="docGeneratedContent" style="display:none; padding: 30px; overflow-y: auto; height: 100%; background: white;">
          <!-- N·ªôi dung HTML s·∫Ω ƒë∆∞·ª£c load v√†o ƒë√¢y -->
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="linkedBookingModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-info-subtle">
        <h5 class="modal-title"><i class="bi bi-link-45deg"></i> Th√¥ng tin cu·ªôc h·ªçp g·ªëc</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="linkedBookingContent">
        ƒêang t·∫£i...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">ƒê√≥ng</button>
      </div>
    </div>
  </div>
</div>
  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/navbar.js"></script> <!-- file navbar logic b·∫°n v·ª´a t·∫°o -->
  <script>
    $(document).ready(function() {
      // T·∫£i navbar.html v√† √©p tr√¨nh duy·ªát kh√¥ng d√πng cache c≈©
      $("#navbar-placeholder").load("navbar.html?v=" + Math.random(), function(response, status, xhr) {
        if (status == "error") {
          console.log("L·ªói t·∫£i navbar: " + xhr.status + " " + xhr.statusText);
        } else {
          // Load xong HTML th√¨ m·ªõi ch·∫°y logic JS
          console.log("Navbar HTML loaded!");
          if (typeof initNavbar === "function") {
              initNavbar();
          }
        }
      });
    });
  </script>
  <!-- Select2 -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/documents.js"></script>
</body>
</html>
