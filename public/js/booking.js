async function api(path, opts={}){ const res = await fetch('/api' + path, opts); if(!res.ok) throw new Error(await res.text()); return res.json(); } async function loadRooms(){ const rooms = await api('/rooms'); const sel = document.getElementById('roomSelect'); sel.innerHTML=''; rooms.forEach(r=>{ const opt = document.createElement('option'); opt.value = r.id; opt.textContent = r.name + ' (' + r.code + ') - ' + r.capacity + ' người'; sel.appendChild(opt); }); } document.getElementById('bookForm').addEventListener('submit', async (e)=>{ e.preventDefault(); const result = document.getElementById('result'); try { const payload = { room_id: Number(document.getElementById('roomSelect').value), title: document.getElementById('title').value.trim(), organizer: document.getElementById('organizer').value.trim(), start_iso: document.getElementById('start').value, end_iso: document.getElementById('end').value }; const res = await fetch('/api/book', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) }); if(!res.ok){ const txt = await res.text(); result.innerHTML = `<div class="alert alert-danger">Lỗi: ${txt}</div>`; return; } const data = await res.json(); result.innerHTML = `<div class="alert alert-success">Đặt phòng thành công: ${data.booking.title}</div>`; document.getElementById('bookForm').reset(); } catch(err) { result.innerHTML = `<div class="alert alert-danger">Lỗi: ${err.message}</div>`; } }); loadRooms();